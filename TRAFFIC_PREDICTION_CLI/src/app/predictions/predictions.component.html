<div id="predictionComponentBody">
    <nav class="navbar fixed-top navbar-expand-lg bg-body-tertiary" aria-label="navbar"
        style="background-color: #e6e6e6;">
        <div class="container-fluid" style="background-color: #e6e6e6">
            <a class="navbar-brand">
                <span>
                    <button mat-icon-button class="example-icon" data-bs-toggle="offcanvas"
                        data-bs-target="#offcanvasWithBothOptions" aria-controls="offcanvasWithBothOptions">
                        <mat-icon>menu</mat-icon>
                    </button>
                </span>
            </a>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li style="font-size: 20px" class="nav-item">Traffic Intensity Prediction and Recommendation</li>
                </ul>
                <form class="d-flex" role="search">
                    <button mat-icon-button class="example-icon favorite-icon"
                        aria-label="Example icon-button with heart icon">
                        <mat-icon>account_circle</mat-icon>
                    </button>
                </form>
            </div>
        </div>
    </nav>

    <br /><br /><br /><br />

    <div class="offcanvas offcanvas-start" data-bs-scroll="true" tabindex="-1" id="offcanvasWithBothOptions"
        aria-labelledby="offcanvasWithBothOptionsLabel">
        <div class="offcanvas-header">
            <h1 style="margin-left: 125px" class="offcanvas-title" id="offcanvasExampleLabel">Menu</h1>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <mat-divider></mat-divider>
        <div class="offcanvas-body">
            <ul class="list-group list-group-flush">
                <li class="offcanvasList list-group-item" (click)="navigateToTraining()">
                    <span style="float:left">Training</span>
                    <mat-icon style="float:right">keyboard_arrow_right</mat-icon>
                </li>
                <li class="offcanvasList list-group-item" data-bs-dismiss="offcanvas">
                    <span style="float:left">Predictions</span>
                    <mat-icon style="float:right">keyboard_arrow_right</mat-icon>
                </li>
                <li class="offcanvasList list-group-item" (click)="navigateToAdminInputs()">
                    <span style="float:left">Provide Junction Properties</span>
                    <mat-icon style="float:right">keyboard_arrow_right</mat-icon>
                </li>
            </ul>
        </div>
    </div>


    <section>
        <div *ngIf="toggleSuccessToast" class="toast show position-fixed bottom-0 end-0 p-3 box-overlay" role="alert"
            aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <span class="me-3">
                    <mat-icon style="color:green">check_circle</mat-icon>
                </span>
                <strong class="me-auto">System</strong>
                <small>1 second ago</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" style="color: green">
                {{ errorString }}
            </div>
        </div>
        <div *ngIf="toggleWarningToast" class="toast show position-fixed bottom-0 end-0 p-3 box-overlay" role="alert"
            aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <span class="me-3">
                    <mat-icon color="warn">report</mat-icon>
                </span>
                <strong class="me-auto">System</strong>
                <small>1 second ago</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" style="color: red">
                {{ errorString }}
            </div>
        </div>





        <div *ngIf="!predictionsExist" id="maincontainer2" class="
                container
                my-5 
                bg-primary 
                shadow-lg 
                p-3 
                mb-5 
                bg-white 
                rounded
        ">
            <div class="card text-center text-bg-danger mb-3">
                <div class="card-header">
                    Note! Entries not found. Please sign in again after some time
                </div>
            </div>
        </div>





        <mat-stepper *ngIf="predictionsExist" orientation="horizontal" [linear]="isLinear" #stepper>
            <mat-step>
                <ng-template matStepLabel>See Predictions</ng-template>
                <mat-progress-bar *ngIf="!predictionsReady" mode="indeterminate"></mat-progress-bar>
                <div *ngIf="predictionsReady">
                    <mat-card>
                        <nav id="navbar-example3" class="navbar bg-body-tertiary px-3 mb-3"
                            aria-labelledby="navHeading">
                            <ul class="nav nav-pills">
                                <div class="container">
                                    <div class="row">
                                        <div style="width: 260px" class="col">
                                            <h4>Result for Junction</h4>
                                        </div>
                                        <div class="col">
                                            <select style="width: 200px" class="form-select" (change)="predict()"
                                                [(ngModel)]="junctionChoice" aria-label="Default select example">
                                                <option *ngFor="let junction of junctions" [value]="junction">{{
                                                    junction }}</option>
                                            </select>
                                        </div>
                                        <div class="col">
                                            <h4>
                                                from
                                                <strong>
                                                    {{ startYear }} to {{ startYear + 2 }}
                                                </strong>
                                            </h4>
                                        </div>
                                    </div>
                                </div>
                            </ul>
                            <select style="width: 150px" class="form-select" [(ngModel)]="predictionsOption"
                                (change)="changePredictionsOption()" aria-label="Default select example">
                                <option selected>Line Plot</option>
                                <option value="Table">Table</option>
                            </select>
                        </nav>
                        <mat-card-content>

                            <div>
                                <div class="row">
                                    <div class="col">
                                        <div *ngIf="predictionsOption == 'Line Plot' && resultTableReady">
                                            <div>
                                                <div echarts [options]="mapOptionFuturePredictions"
                                                    class="demo-chart"></div>
                                            </div>
                                        </div>
                                        <div *ngIf="predictionsOption == 'Table' && resultTableReady">
                                            <table class="table table-bordered border table-striped"
                                                aria-describedby="table2-desc">
                                                <thead>
                                                    <tr>
                                                        <th scope="col">DateTime</th>
                                                        <th scope="col">Vehicles</th>
                                                        <th scope="col">Year</th>
                                                        <th scope="col">Month</th>
                                                        <th scope="col">Day</th>
                                                        <th scope="col">Hour</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr *ngFor="let record of dataSourceResult">
                                                        <th scope="row">{{ record.DateTime }}</th>
                                                        <td>{{ record.Vehicles }}</td>
                                                        <td>{{ record.Year }}</td>
                                                        <td>{{ record.Month }}</td>
                                                        <td>{{ record.Day }}</td>
                                                        <td>{{ record.Hour }}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <!--
                                                    ** Paginator for Prediction table **
                                                -->
                                            <div id="paginator2" class="justify-content-end btn-group" role="group"
                                                aria-label="Button group with nested dropdown">
                                                <button type="button" [ngClass]="classForPreviousButtonResult"
                                                    (click)="previousResult()"
                                                    class="btn btn-outline-secondary">{{'\u21E6'}}</button>
                                                <button type="button" id="paginator2indicator"
                                                    class="btn btn-outline-secondary" disabled>{{indexResult}} -
                                                    {{indexResult + 10}} of
                                                    {{numberOfRecordsResult}}</button>
                                                <button type="button" [ngClass]="classForNextButtonResult"
                                                    (click)="nextResult()"
                                                    class="btn btn-outline-secondary">{{'\u21E8'}}</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div>
                                            <div class="alert alert-{{alert}}">
                                                <section>
                                                    <div class="collapse show" id="collapseStarsTable">
                                                        <div>
                                                            <div>
                                                                <button mat-fab extended color="warn" (click)="openRatingInfoDialog()">
                                                                    <mat-icon
                                                                        *ngFor="let icon of starsTableDesc[importanceLevel]">{{
                                                                        icon }}</mat-icon>
                                                                </button>
                                                                <button mat-button color="warn" (click)="openRatingInfoDialog()"
                                                                    >Rating: {{
                                                                    ratingOutOfFive }} / 5</button>
                                                                <button mat-icon-button type="button" (click)="openRatingInfoDialog()"
                                                                >
                                                                    <mat-icon>info</mat-icon>
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <div>
                                                                <button mat-button color="primary"
                                                                    *ngIf="alreadyRecommended">
                                                                    <mat-icon>check</mat-icon>
                                                                    {{ this.junctionChoice }}: Already recommended for {{startYear}} - {{startYear
                                                                    + 2}}
                                                                </button>
                                                            </div>
                                                            <div>
                                                                <button mat-button color="warn"
                                                                    *ngIf="!alreadyRecommended">
                                                                    <mat-icon>close</mat-icon>
                                                                    Treatment recommendation for {{startYear}} - {{startYear +
                                                                    2}} not enqueued
                                                                </button>
                                                            </div>
                                                            <mat-divider></mat-divider>
                                                            <h2>
                                                                {{starsTableMeaning[importanceLevel][0]}}
                                                            </h2>
                                                            <h2>
                                                                {{starsTableMeaning[importanceLevel][1]}}
                                                            </h2>
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <p><mat-checkbox [(ngModel)]="checkRecommendation"
                                                                color="primary"
                                                                [disabled]="alreadyRecommended">Recommend
                                                                treatment for ({{ this.junctionChoice }}, {{
                                                                this.currentDistrict }}
                                                                district)? </mat-checkbox></p>
                                                    </div>
                                                    <div>
                                                        <span>
                                                            <button mat-raised-button
                                                                [disabled]="alreadyRecommended || !checkRecommendation"
                                                                (click)="enqueueRecommendation()"><mat-icon>queue</mat-icon>Enqueue
                                                                treatment
                                                                recommendation</button>
                                                        </span>
                                                        <span style="padding-left: 10px">
                                                            <button mat-raised-button [disabled]="alert=='danger'"
                                                                (click)="dequeueRecommendation()"><mat-icon>remove_circle_outline</mat-icon>Dequeue
                                                                Recommendation</button>
                                                        </span>
                                                    </div>
                                                    <div>
                                                        <div style="padding-top: 10px">
                                                            <span style="padding-left: 10px">
                                                                <button mat-raised-button color="primary"
                                                                    (click)="downloadPredictions()"><mat-icon>save</mat-icon>Download
                                                                    Predictions as csv file</button>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </section>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>


                        </mat-card-content>
                    </mat-card>
                </div>

            </mat-step>


            <mat-step>
                <ng-template matStepLabel>Districts with treatments</ng-template>



                <div style="padding-left: 200px; padding-right: 200px; padding-top: 20px">
                    <div class="card border-primary mb-3">
                        <div class="card-header">
                            <small class="text-body-secondary">
                                <ul class="nav nav-pills card-header-pills">
                                    <li>
                                        <span>
                                            <h3>2 years from: </h3>
                                        </span>
                                    </li>
                                    <li class="nav-item">
                                        <span>
                                            <select [(ngModel)]="yearToRender" (change)="changeYearToRender()"
                                                style="width: 150px" class="form-select"
                                                aria-label="Default select example">
                                                <option *ngFor="let year of allYears" [value]="year">{{ year }}</option>
                                            </select>
                                        </span>
                                    </li>
                                    <li class="nav-item" style="float:right">
                                        <span>
                                            <select style="width: 150px" class="form-select"
                                                [(ngModel)]="representationFormat"
                                                (change)="changeRepresentationFormat()"
                                                aria-label="Default select example">
                                                <option value="Geomap">Geomap</option>
                                                <option value="Table">Table</option>
                                            </select>
                                        </span>
                                    </li>
                                </ul>
                            </small>
                        </div>
                        <div class="card-body">
                            <div *ngIf="!showGeoMap">
                                <div>
                                    <div class="card text-center">
                                        <div id="main" echarts [options]="mapOption"
                                            style="width: 900px; height: 600px;" class="demo-chart"
                                            (chartClick)="onChartClick($event)"></div>
                                    </div>
                                </div>
                            </div>
                            <div *ngIf="showGeoMap">
                                <table aria-label="starsinfo()" class="table">
                                    <thead>
                                        <tr>
                                            <th scope="col">District</th>
                                            <th scope="col">Number of treatment recommendations</th>
                                            <th scope="col">StartYear</th>
                                            <th scope="col">Duration</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let element of allDistrictsRecommended">
                                            <th scope="row">{{ element.districtName }}</th>
                                            <td>{{ element.numberOfTreatmentRecommendations }}</td>
                                            <td>{{ element.startYear }}</td>
                                            <td>{{ element.durationYears }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="card-footer" *ngIf="districtClicked">
                            <div>
                                <table class="table" aria-label="info table">
                                    <thead>
                                        <tr>
                                            <th scope="col">Junction</th>
                                            <th scope="col">District</th>
                                            <th scope="col">from (Year)</th>
                                            <th scope="col">Duration</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let instance of districtClickInfoTable">
                                            <td>{{ instance.junctionName }}</td>
                                            <td>{{ instance.districtName }}</td>
                                            <td>{{ instance.startYear }}</td>
                                            <td>{{ instance.durationYears }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

            </mat-step>


            <mat-step *ngIf="autoTrained">

                <ng-template matStepLabel>Accuracies of different junctions</ng-template>
                <div style="padding-top: 10px" class="container">
                    <div class="row">
                        <div class="col">
                            <nav id="navbar-example3" class="navbar bg-body-tertiary px-3 mb-3"
                                aria-labelledby="navHeading">
                                <ul class="nav nav-pills">
                                    <div class="container">
                                        <div class="row">
                                            <div style="width: 240px" class="col">
                                                <h4>Accuracy for junction</h4>
                                            </div>
                                            <div class="col">
                                                <select style="width: 200px" class="form-select"
                                                    (change)="renderJunctionAccuracyPie()" [(ngModel)]="currentPie"
                                                    aria-label="Default select example">
                                                    <option *ngFor="let junction of junctions" [value]="junction">{{
                                                        junction }}</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </ul>
                            </nav>
                            <div>
                                <div>
                                    <div>
                                        <div echarts [options]="mapOptionAccuracyPie" class="demo-chart"></div>
                                        <canvas width="600" height="600" id="accuracyPie"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </mat-step>
        </mat-stepper>
    </section>


</div>